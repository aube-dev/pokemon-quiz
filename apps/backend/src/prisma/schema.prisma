generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String        @id @default(uuid())
  sn           String        @unique @map("sn")
  username     String?       @map("username")
  totalScore   Int           @default(0) @map("total_score")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  userProblems UserProblem[]

  @@index([totalScore(sort: Desc)])
  @@map("users")
}

model Problem {
  id           String        @id @default(uuid())
  title        String        @map("title")
  category     String        @map("category")
  score        Int           @map("score")
  content      Json          @map("data")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  number       Int           @unique @default(autoincrement()) @map("problem_number")
  answer       Json          @map("answer")
  userProblems UserProblem[]

  @@map("problems")
}

model UserProblem {
  id           String          @id @default(uuid())
  userId       String          @map("user_id")
  problemId    String          @map("problem_id")
  status       ChallengeStatus @map("status")
  score        Int             @map("score")
  submittedAt  DateTime        @default(now()) @map("submitted_at")
  challengedAt DateTime?       @map("challenged_at")
  problem      Problem         @relation(fields: [problemId], references: [id])
  user         User            @relation(fields: [userId], references: [id])

  @@unique([userId, problemId])
  @@map("user_problems")
}

model EventConfig {
  id             Int      @id @default(1)
  eventStartTime DateTime @map("event_start_time")
  eventEndTime   DateTime @map("event_end_time")

  @@map("event_configs")
}

enum ChallengeStatus {
  CORRECT
  WRONG
  GIVEN_UP
  CHALLENGING

  @@map("challenge_status")
}
